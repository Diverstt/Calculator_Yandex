# Calculator_Yandex
# Распределённый вычислитель арифметических выражений

Этот проект представляет собой распределённую систему для вычисления арифметических выражений. Он разделён на две основные части:

- **Оркестратор (Server):**  
  Принимает арифметическое выражение, разбирает его на абстрактное синтаксическое дерево (АСД) и генерирует набор задач для вычислений.  
  Предоставляет HTTP‑эндпоинты для отправки выражения, получения статусов и результатов вычислений.

- **Агент (Worker):**  
  Демон, который постоянно опрашивает оркестратор на наличие задач, выполняет операции (с искусственными задержками) и отправляет результаты обратно на сервер.  
  Количество рабочих (горутин) настраивается через переменную окружения.

Проект реализован на Go и покрыт тестами. Он также контейнеризирован с использованием Docker и Docker Compose, что позволяет запустить всю систему одной командой.


---

## Как работает система

1. **Приём выражения:**  
   Клиент отправляет POST-запрос на эндпоинт `/api/v1/calculate` с JSON-объектом, содержащим поле `"expression"`.  
   Пример: `"2+2*2"` или `"(2+2)*2"`.

2. **Парсинг и планирование задач:**  
   Оркестратор парсит выражение с помощью стандартного парсера Go (учитывая скобки и приоритеты) и строит АСД.  
   Для каждого оператора генерируются задачи, которые добавляются в приоритетную очередь.  
   Приоритет определяется типом операции (умножение и деление – выше, сложение и вычитание – ниже).

3. **Вычисление задач:**  
   Агент, запущенный в виде нескольких горутин, постоянно запрашивает задачу через GET-запрос на `/internal/task`.  
   После получения задачи агент имитирует «тяжёлое» вычисление (с задержкой, зависящей от типа операции), вычисляет результат и отправляет его через POST-запрос на `/internal/task/result`.  
   При делении на ноль агент возвращает ошибку, которая приводит к установке статуса выражения в `"error"`.

4. **Получение результата:**  
   Клиент может периодически опрашивать статус вычисления выражения через GET-запросы на `/api/v1/expressions` или `/api/v1/expressions/:id`.  
   Если вычисление завершено, результат будет доступен в ответе.


## Как запустить проект

### Требования
- [Go](https://golang.org/) (для локальной сборки и тестирования)
- [Docker](https://www.docker.com/get-started) и [Docker Compose](https://docs.docker.com/compose/)  
  *(Docker Compose обычно входит в состав Docker Desktop для Windows/Mac или устанавливается отдельно на Linux)*

### Запуск через Docker Compose

1. **Клонируйте репозиторий:**
   ```bash
   git clone https://github.com/Diverstt/Calculator_Yandex.git
   cd Calculator_Yandex

2. **Соберите и запустите контейнеры одной командой:**

```bash

docker-compose up --build
```
3. **Запуск локально (без Docker)**
Запуск оркестратора:

```bash

cd cmd/orchestrator
PORT=8080 go run main.go
```

Запуск агента:

```bash

cd cmd/agent
COMPUTING_POWER=4 ORCHESTRATOR_URL=http://localhost:8080 go run main.go 
```

**Примеры использования через cURL**
Добавление выражения:

bash
curl --location 'http://localhost:8080/api/v1/calculate' \
     --header 'Content-Type: application/json' \
     --data '{"expression": "(2+2)*2"}'


Получение списка выражений:

```bash
curl --location 'http://localhost:8080/api/v1/expressions'
```


Получение выражения по ID:

```bash
curl --location 'http://localhost:8080/api/v1/expressions/<id>'
```

Получение задачи (агент использует этот endpoint):

```bash
curl --location 'http://localhost:8080/internal/task'
```

Отправка результата задачи (агент использует этот endpoint):


```bash
curl --location 'http://localhost:8080/internal/task/result' \
     --header 'Content-Type: application/json' \
     --data '{"id": "<task_id>", "result": 4, "error": ""}'
```